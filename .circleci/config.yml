version: 2.1
orbs:
  win: circleci/windows@2.4.0
jobs:   
  lint-unit-39: &lint-unit
    docker:
      - image: circleci/python:3.6.1

    
    steps:
      - checkout
      - run:
          name: install dependencies
          command: |
            python3 -m venv venv
            . venv/bin/activate
            sudo apt-get update
            sudo apt-get install -y python-dev libldap2-dev libsasl2-dev libssl-dev
            python --version
            pip install --upgrade pip
            make requirements
            make black-check
            make isort-check
            uname -m
            pip --version
      - run:
          name: run tests
          command: |
            . venv/bin/activate
            black --check setup.py flask_appbuilder 
  build-medium-amd64:
    machine:
      image: ubuntu-2004:202101-01
   
    working_directory: ~/python-lz4
    steps:      
      - checkout
      - run:
          name: ️️requirements
          command: |
             uname -m 
             python3 -m venv venv
             . venv/bin/activate
             sudo apt-get update
             sudo apt install python3
             sudo apt-get install python3-pip
             pip3 install tox
             pip install coverage
             pip install pytest
             pip install aiohttp
             curl -sSL https://install.python-poetry.org | python3 -
             export PATH="/home/circleci/.local/bin:$PATH"
             coverage erase
             coverage run --source pykwalify -p -m py.test -v -s
             python setup.py sdist bdist
      - run: 
          name: test
          command: |
             make test
workflows:
 version: 2
 python3.9:
   jobs:
     - build-medium-amd64

